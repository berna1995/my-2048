(this["webpackJsonpmy-2048"]=this["webpackJsonpmy-2048"]||[]).push([[0],{14:function(t,e,n){},15:function(t,e,n){"use strict";n.r(e);var i=n(3),a=n.n(i),s=n(8),o=n.n(s),r=n(1),l=n(2),c=n(5),u=n(4),h=n(6),m=function(){function t(e){Object(r.a)(this,t),this.startTime=null,this.duration=e,this.animationDone=!1}return Object(l.a)(t,[{key:"getTimeRatio",value:function(t){if(null===this.startTime)return this.startTime=t,0;var e=t-this.startTime,n=Math.min(1,e/this.duration);return n>=1&&(this.animationDone=!0),n}},{key:"isDone",value:function(){return this.animationDone}},{key:"reset",value:function(t){this.startTime=t,this.animationDone=!1}}]),t}(),p=function(){function t(e,n,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object(r.a)(this,t),this.fromValue=e,this.toValue=n,this.valDiff=n-e,this.currentVal=e,this.reverse=a,this.animationHelper=new m(i)}return Object(l.a)(t,[{key:"setUpdatedValueCallback",value:function(t){return this.updateCallback=t,this}},{key:"update",value:function(t){var e=this.animationHelper.getTimeRatio(t);if(this.currentVal=this.fromValue+this.valDiff*e,this.updateCallback&&this.updateCallback(this.currentVal),this.animationHelper.isDone()&&this.reverse){this.reverse=!1,this.animationHelper.reset(t);var n=this.fromValue;this.fromValue=this.toValue,this.toValue=n,this.valDiff=this.toValue-this.fromValue,this.currentVal=this.fromValue}}},{key:"getCurrentValue",value:function(){return this.currentVal}},{key:"isCompleted",value:function(){return this.animationHelper.isDone()}}]),t}(),v=function(){function t(){Object(r.a)(this,t),this.animationList=[],this.currentAnimationIndex=0}return Object(l.a)(t,[{key:"update",value:function(t){if(this.currentAnimationIndex<this.animationList.length){var e=this.animationList[this.currentAnimationIndex];e.update(t),e.isCompleted()&&this.currentAnimationIndex++}}},{key:"addAnimator",value:function(t){this.animationList.push(t)}},{key:"isCompleted",value:function(){return this.animationList.every((function(t){return t.isCompleted()}))}}]),t}(),d=n(0),f=function(t){Object(c.a)(n,t);var e=Object(u.a)(n);function n(t){var i;return Object(r.a)(this,n),(i=e.call(this,t)).divRef=a.a.createRef(),i.animate=i.animate.bind(Object(h.a)(i)),i.resetAnimationStatus(),i.state={translationX:0,translationY:0,scaleFactor:100},i.recycled=!1,i}return Object(l.a)(n,[{key:"render",value:function(){var t={gridRow:this.props.cell.row+1,gridColumn:this.props.cell.col+1};this.props.cell.isMoving()&&(t.transform="translate(".concat(this.state.translationX,"px, ").concat(this.state.translationY,"px) scale(").concat(this.state.scaleFactor,"%)"));var e=[];e.push("value-cell"),e.push("value-".concat(Math.min(2048,this.props.cell.val))),e.push(this.props.cell.isGettingMerged()?"value-cell-merged":"value-cell-top"),this.recycled||(e.push("value-cell-pop-in"),this.recycled=!0);var n=e.join(" ");return Object(d.jsx)("div",{className:n,style:t,ref:this.divRef,children:this.props.cell.val})}},{key:"componentDidUpdate",value:function(t){t.cell.isMoving()&&!this.props.cell.isMoving()&&this.resetAnimationStatus(),this.props.cell.isMoving()&&!this.animationDone&&0===this.animationRequestId&&(this.animation=this.prepareAnimation(),this.animationRequestId=window.requestAnimationFrame(this.animate))}},{key:"componentWillUnmount",value:function(){0!==this.animationRequestId&&window.cancelAnimationFrame(this.animationRequestId)}},{key:"animate",value:function(t){this.animation.update(t),this.animation.isCompleted()?(this.animation=null,this.animationDone=!0,this.animationRequestId=0,this.props.animationDoneCallback()):this.animationRequestId=window.requestAnimationFrame(this.animate)}},{key:"prepareAnimation",value:function(){var t=this,e=new v,i=this.props.cell.colDestination-this.props.cell.col,a=this.props.cell.rowDestination-this.props.cell.row,s=Number.parseInt(getComputedStyle(this.divRef.current).getPropertyValue("--grid-border").trim().replace("px","")),o=this.divRef.current.getBoundingClientRect(),r=o.width,l=o.height,c=0!==i,u=c?i*r+s*i:a*l+s*a,h=c?i:a,m=Math.abs(h)*n.TRANSLATION_1_CELL_DURATION,d=new p(0,u,m).setUpdatedValueCallback((function(e){var n=0!==i?e:0,s=0!==a?e:0;t.setState({translationX:n,translationY:s})}));if(e.addAnimator(d),this.props.cell.isMergingInto()){var f=new p(100,110,n.SCALING_DURATION,!0).setUpdatedValueCallback((function(e){t.setState({scaleFactor:e})}));e.addAnimator(f)}return e}},{key:"resetAnimationStatus",value:function(){this.animation=null,this.animationDone=!1,this.animationRequestId=0}}]),n}(a.a.Component);f.TRANSLATION_1_CELL_DURATION=100,f.SCALING_DURATION=100;var y=function(t){Object(c.a)(n,t);var e=Object(u.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(d.jsx)("div",{className:"bg-cell",style:{gridRow:this.props.row+1,gridColumn:this.props.col+1}})}}]),n}(a.a.Component),g=0,b=1,k=2,w=3;function O(t){return Math.floor(Math.random()*t)}var j=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;Object(r.a)(this,t),this.row=e,this.col=n,this.val=i,this.nextVal=a,this.rowDestination=s,this.colDestination=o,this.mergedInto=l,this.mergingInto=c,this.cellIdentifier=u||t.nextIdentifierAvailable++}return Object(l.a)(t,[{key:"isEmpty",value:function(){return 0===this.val}},{key:"applyMoveAndClear",value:function(){this.isMoving()&&(this.row=this.rowDestination,this.col=this.colDestination,0!==this.nextVal&&(this.val=this.nextVal,this.nextVal=0),this.rowDestination=null,this.colDestination=null,this.mergingInto=!1,this.mergedInto=!1)}},{key:"moveBy",value:function(t,e){switch(null===this.rowDestination&&(this.rowDestination=this.row),null===this.colDestination&&(this.colDestination=this.col),e){case g:this.rowDestination=this.rowDestination-t;break;case k:this.rowDestination=this.rowDestination+t;break;case w:this.colDestination=this.colDestination-t;break;case b:this.colDestination=this.colDestination+t;break;default:return}}},{key:"isMoving",value:function(){return null!==this.rowDestination||null!==this.colDestination}},{key:"markGettingMerged",value:function(){this.mergedInto=!0}},{key:"markMerging",value:function(){this.mergingInto=!0}},{key:"isGettingMerged",value:function(){return this.mergedInto}},{key:"isMergingInto",value:function(){return this.mergingInto}},{key:"copy",value:function(){return new t(this.row,this.col,this.val,this.nextVal,this.rowDestination,this.colDestination,this.mergedInto,this.mergingInto,this.cellIdentifier)}}]),t}();j.nextIdentifierAvailable=1;var D=function(){function t(e,n,i){Object(r.a)(this,t),this.ROWS=e,this.COLUMNS=n,i?this.cells=i:(this.cells=Array(e).fill().map((function(){return Array(n).fill()})),t.initializeGrid(this.cells,e,n))}return Object(l.a)(t,[{key:"copy",value:function(){var e=this.cells.map((function(t){return t.map((function(t){return t.copy()}))}));return new t(this.ROWS,this.COLUMNS,e)}},{key:"getNonEmptyCells",value:function(){var t=[];return this.cells.forEach((function(e){e.forEach((function(e){e.isEmpty()||t.push(e)}))})),t}},{key:"applyMoves",value:function(){var e=this.copy(),n=e.cells.flat();return t.initializeGrid(e.cells,e.ROWS,e.COLUMNS),n.forEach((function(t){t.isMoving()?t.isGettingMerged()||(e.cells[t.rowDestination][t.colDestination]=t,t.applyMoveAndClear()):t.isEmpty()||t.isGettingMerged()||(e.cells[t.row][t.col]=t)})),e}},{key:"spawnCells",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=[];if(this.cells.forEach((function(t){t.forEach((function(t){t.isEmpty()&&n.push(t)}))})),n.length<t)return!1;for(var i=0;i<t;i++){var a=O(n.length),s=n[a];this.cells[s.row][s.col].val=e,n.splice(a,1)}return!0}},{key:"move",value:function(t){var e=this.copy(),n=[];switch(t){case g:for(var i=0;i<e.COLUMNS;i++){for(var a=[],s=0;s<e.ROWS;s++)a.push(e.cells[s][i]);n.push(a)}break;case k:for(var o=0;o<e.COLUMNS;o++){for(var r=[],l=e.ROWS-1;l>=0;l--)r.push(e.cells[l][o]);n.push(r)}break;case w:n=e.cells.map((function(t){return t.slice()}));break;case b:n=e.cells.map((function(t){return t.slice().reverse()}));break;default:return}return n.forEach((function(e){for(var n=null,i=0;i<e.length;i++){var a=e[i];if(a.isEmpty())for(var s=i+1;s<e.length;s++)e[s].isEmpty()||e[s].moveBy(1,t);else if(null===n)n=a;else if(n.val===a.val){n.markGettingMerged(),a.nextVal=2*a.val,a.markMerging();for(var o=i;o<e.length;o++)e[o].isEmpty()||e[o].moveBy(1,t);n=null}else n=a}})),e.cells.flat().reduce((function(t,e){return t+(e.isMoving()?1:0)}),0)?e:this}},{key:"toString",value:function(){return this.cells.map((function(t){return t.map((function(t){return t.val})).join(" ")})).join("\r\n")}}],[{key:"initializeGrid",value:function(t,e,n){for(var i=0;i<e;i++)for(var a=0;a<n;a++)t[i][a]=new j(i,a);return t}}]),t}(),C=function(t){Object(c.a)(n,t);var e=Object(u.a)(n);function n(t){var i;Object(r.a)(this,n),(i=e.call(this,t)).handleKeyDown=i.handleKeyDown.bind(Object(h.a)(i)),i.handleAnimationDone=i.handleAnimationDone.bind(Object(h.a)(i));var a=new D(t.rows,t.columns);return a.spawnCells(1),i.state={board:a},i.acceptInput=!0,i.expectedAnimations=-1,i}return Object(l.a)(n,[{key:"generateBackgroundCells",value:function(t,e){for(var n=[],i=0;i<t;i++)for(var a=0;a<e;a++)n.push(Object(d.jsx)(y,{row:i,col:a},i*e+a));return n}},{key:"handleAnimationDone",value:function(){if(this.expectedAnimations-=1,0===this.expectedAnimations){var t=this.state.board.applyMoves();t.spawnCells(1),this.acceptInput=!0,this.setState({board:t})}}},{key:"handleKeyDown",value:function(t){if(this.acceptInput){var e,n,i=this.state.board;switch(t.keyCode){case 40:n=k;break;case 39:n=b;break;case 38:n=g;break;case 37:n=w;break;default:return}(e=i.move(n))!==i&&(this.acceptInput=!1,this.expectedAnimations=e.cells.flat().reduce((function(t,e){return t+(e.isMoving()?1:0)}),0),this.setState({board:e}))}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var t=this,e=this.generateBackgroundCells(this.props.rows,this.props.columns),n=this.state.board.getNonEmptyCells().map((function(e){return Object(d.jsx)(f,{cell:e,animationDoneCallback:t.handleAnimationDone},e.cellIdentifier)}));return Object(d.jsxs)("div",{className:"gamegrid",children:[e,n]})}}]),n}(a.a.Component),I=function(t){Object(c.a)(n,t);var e=Object(u.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(d.jsx)("div",{className:"header",children:Object(d.jsx)("h1",{children:" My-2048 "})})}}]),n}(a.a.Component),A=function(t){Object(c.a)(n,t);var e=Object(u.a)(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){return Object(d.jsxs)("div",{className:"gamecontainer",children:[Object(d.jsx)(I,{}),Object(d.jsx)(C,{rows:this.props.rows,columns:this.props.columns})]})}}]),n}(a.a.Component);n(14);o.a.render(Object(d.jsx)(A,{rows:4,columns:4}),document.getElementById("root"))}},[[15,1,2]]]);
//# sourceMappingURL=main.ab78c16c.chunk.js.map