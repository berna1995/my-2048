(this["webpackJsonpmy-2048"]=this["webpackJsonpmy-2048"]||[]).push([[0],{14:function(t,e,n){},15:function(t,e,n){"use strict";n.r(e);var i=n(3),a=n.n(i),s=n(8),r=n.n(s),o=n(4),l=n(1),c=n(2),u=n(6),h=n(5),d=function(){function t(e){Object(l.a)(this,t),this.startTime=null,this.duration=e,this.animationDone=!1}return Object(c.a)(t,[{key:"getTimeRatio",value:function(t){if(null===this.startTime)return this.startTime=t,0;var e=t-this.startTime,n=Math.min(1,e/this.duration);return n>=1&&(this.animationDone=!0),n}},{key:"isDone",value:function(){return this.animationDone}},{key:"reset",value:function(t){this.startTime=t,this.animationDone=!1}}]),t}(),p=function(){function t(e,n,i){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object(l.a)(this,t),this.fromValue=e,this.toValue=n,this.valDiff=n-e,this.currentVal=e,this.reverse=a,this.animationHelper=new d(i)}return Object(c.a)(t,[{key:"setUpdatedValueCallback",value:function(t){return this.updateCallback=t,this}},{key:"update",value:function(t){var e=this.animationHelper.getTimeRatio(t);if(this.currentVal=this.fromValue+this.valDiff*e,this.updateCallback&&this.updateCallback(this.currentVal),this.animationHelper.isDone()&&this.reverse){this.reverse=!1,this.animationHelper.reset(t);var n=this.fromValue;this.fromValue=this.toValue,this.toValue=n,this.valDiff=this.toValue-this.fromValue,this.currentVal=this.fromValue}}},{key:"getCurrentValue",value:function(){return this.currentVal}},{key:"isCompleted",value:function(){return this.animationHelper.isDone()}}]),t}(),m=function(){function t(){Object(l.a)(this,t),this.animationList=[],this.currentAnimationIndex=0}return Object(c.a)(t,[{key:"update",value:function(t){if(this.currentAnimationIndex<this.animationList.length){var e=this.animationList[this.currentAnimationIndex];e.update(t),e.isCompleted()&&this.currentAnimationIndex++}}},{key:"addAnimator",value:function(t){this.animationList.push(t)}},{key:"isCompleted",value:function(){return this.animationList.every((function(t){return t.isCompleted()}))}}]),t}(),v=n(0),f=function(t){Object(u.a)(n,t);var e=Object(h.a)(n);function n(t){var i;return Object(l.a)(this,n),(i=e.call(this,t)).divRef=a.a.createRef(),i.animate=i.animate.bind(Object(o.a)(i)),i.resetAnimationStatus(),i.state={translationX:0,translationY:0,scaleFactor:100},i.recycled=!1,i}return Object(c.a)(n,[{key:"render",value:function(){var t={gridRow:this.props.cell.row+1,gridColumn:this.props.cell.col+1};this.props.cell.isMoving()&&(t.transform="translate(".concat(this.state.translationX,"px, ").concat(this.state.translationY,"px) scale(").concat(this.state.scaleFactor,"%)"));var e=[];e.push("value-cell"),e.push("value-".concat(Math.min(2048,this.props.cell.val))),e.push(this.props.cell.isGettingMerged()?"value-cell-merged":"value-cell-top"),this.recycled||(e.push("value-cell-pop-in"),this.recycled=!0);var n=e.join(" ");return Object(v.jsx)("div",{className:n,style:t,ref:this.divRef,children:this.props.cell.val})}},{key:"componentDidUpdate",value:function(t){t.cell.isMoving()&&!this.props.cell.isMoving()&&this.resetAnimationStatus(),this.props.cell.isMoving()&&!this.animationDone&&0===this.animationRequestId&&(this.animation=this.prepareAnimation(),this.animationRequestId=window.requestAnimationFrame(this.animate))}},{key:"componentWillUnmount",value:function(){0!==this.animationRequestId&&window.cancelAnimationFrame(this.animationRequestId)}},{key:"animate",value:function(t){this.animation.update(t),this.animation.isCompleted()?(this.animation=null,this.animationDone=!0,this.animationRequestId=0,this.props.animationDoneCallback()):this.animationRequestId=window.requestAnimationFrame(this.animate)}},{key:"prepareAnimation",value:function(){var t=this,e=new m,i=this.props.cell.colDestination-this.props.cell.col,a=this.props.cell.rowDestination-this.props.cell.row,s=Number.parseInt(getComputedStyle(this.divRef.current).getPropertyValue("--grid-border").trim().replace("px","")),r=this.divRef.current.getBoundingClientRect(),o=r.width,l=r.height,c=0!==i,u=c?i*o+s*i:a*l+s*a,h=c?i:a,d=Math.abs(h)*n.TRANSLATION_1_CELL_DURATION,v=new p(0,u,d).setUpdatedValueCallback((function(e){var n=0!==i?e:0,s=0!==a?e:0;t.setState({translationX:n,translationY:s})}));if(e.addAnimator(v),this.props.cell.isMergingInto()){var f=new p(100,115,n.SCALING_DURATION,!0).setUpdatedValueCallback((function(e){t.setState({scaleFactor:e})}));e.addAnimator(f)}return e}},{key:"resetAnimationStatus",value:function(){this.animation=null,this.animationDone=!1,this.animationRequestId=0}}]),n}(a.a.Component);f.TRANSLATION_1_CELL_DURATION=100,f.SCALING_DURATION=100;var b=function(t){Object(u.a)(n,t);var e=Object(h.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return Object(v.jsx)("div",{className:"bg-cell",style:{gridRow:this.props.row+1,gridColumn:this.props.col+1}})}}]),n}(a.a.Component),g=0,y=1,k=2,O=3,j=0,w=1,C=2;function D(t){return Math.floor(Math.random()*t)}var A=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;Object(l.a)(this,t),this.row=e,this.col=n,this.val=i,this.nextVal=a,this.rowDestination=s,this.colDestination=r,this.mergedInto=o,this.mergingInto=c,this.cellIdentifier=u||t.nextIdentifierAvailable++}return Object(c.a)(t,[{key:"isEmpty",value:function(){return 0===this.val}},{key:"applyMoveAndClear",value:function(){this.isMoving()&&(this.row=this.rowDestination,this.col=this.colDestination,0!==this.nextVal&&(this.val=this.nextVal,this.nextVal=0),this.rowDestination=null,this.colDestination=null,this.mergingInto=!1,this.mergedInto=!1)}},{key:"moveBy",value:function(t,e){switch(null===this.rowDestination&&(this.rowDestination=this.row),null===this.colDestination&&(this.colDestination=this.col),e){case g:this.rowDestination=this.rowDestination-t;break;case k:this.rowDestination=this.rowDestination+t;break;case O:this.colDestination=this.colDestination-t;break;case y:this.colDestination=this.colDestination+t;break;default:return}}},{key:"isMoving",value:function(){return null!==this.rowDestination||null!==this.colDestination}},{key:"markGettingMerged",value:function(){this.mergedInto=!0}},{key:"markMerging",value:function(){this.mergingInto=!0}},{key:"isGettingMerged",value:function(){return this.mergedInto}},{key:"isMergingInto",value:function(){return this.mergingInto}},{key:"copy",value:function(){return new t(this.row,this.col,this.val,this.nextVal,this.rowDestination,this.colDestination,this.mergedInto,this.mergingInto,this.cellIdentifier)}}]),t}();A.nextIdentifierAvailable=1;var I=function(){function t(e,n,i){Object(l.a)(this,t),this.ROWS=e,this.COLUMNS=n,i?this.cells=i:(this.cells=Array(e).fill().map((function(){return Array(n).fill()})),t.initializeGrid(this.cells,e,n))}return Object(c.a)(t,[{key:"copy",value:function(){var e=this.cells.map((function(t){return t.map((function(t){return t.copy()}))}));return new t(this.ROWS,this.COLUMNS,e)}},{key:"getNonEmptyCells",value:function(){var t=[];return this.cells.forEach((function(e){e.forEach((function(e){e.isEmpty()||t.push(e)}))})),t}},{key:"applyMoves",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=e?this:this.copy(),i=n.cells.flat();return t.initializeGrid(n.cells,n.ROWS,n.COLUMNS),i.forEach((function(t){t.isMoving()?t.isGettingMerged()||(n.cells[t.rowDestination][t.colDestination]=t,t.applyMoveAndClear()):t.isEmpty()||t.isGettingMerged()||(n.cells[t.row][t.col]=t)})),n}},{key:"spawnCells",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=n?this:this.copy(),a=[];if(i.cells.forEach((function(t){t.forEach((function(t){t.isEmpty()&&a.push(t)}))})),a.length<t)return this;for(var s=0;s<t;s++){var r=D(a.length),o=a[r];i.cells[o.row][o.col].val=e,a.splice(r,1)}return i}},{key:"move",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e?this:this.copy(),i=[];switch(t){case g:for(var a=0;a<n.COLUMNS;a++){for(var s=[],r=0;r<n.ROWS;r++)s.push(n.cells[r][a]);i.push(s)}break;case k:for(var o=0;o<n.COLUMNS;o++){for(var l=[],c=n.ROWS-1;c>=0;c--)l.push(n.cells[c][o]);i.push(l)}break;case O:i=n.cells.map((function(t){return t.slice()}));break;case y:i=n.cells.map((function(t){return t.slice().reverse()}));break;default:return}i.forEach((function(e){for(var n=null,i=0;i<e.length;i++){var a=e[i];if(a.isEmpty())for(var s=i+1;s<e.length;s++)e[s].isEmpty()||e[s].moveBy(1,t);else if(null===n)n=a;else if(n.val===a.val){n.markGettingMerged(),a.nextVal=2*a.val,a.markMerging();for(var r=i;r<e.length;r++)e[r].isEmpty()||e[r].moveBy(1,t);n=null}else n=a}}));var u=n.cells.flat().reduce((function(t,e){return t+(e.isMoving()?1:0)}),0);return u?n:this}},{key:"checkGameStatus",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2048,n=this.cells.flat(),i=n.some((function(t){return t.val>=e}));if(i)return j;var a=[g,k,O,y],s=a.some((function(e){return t.move(e)!==t}));return s?C:w}},{key:"toString",value:function(){return this.cells.map((function(t){return t.map((function(t){return t.val})).join(" ")})).join("\r\n")}}],[{key:"initializeGrid",value:function(t,e,n){for(var i=0;i<e;i++)for(var a=0;a<n;a++)t[i][a]=new A(i,a);return t}}]),t}(),x=function(t){Object(u.a)(n,t);var e=Object(h.a)(n);function n(t){var i;Object(l.a)(this,n),(i=e.call(this,t)).handleKeyDown=i.handleKeyDown.bind(Object(o.a)(i)),i.handleAnimationDone=i.handleAnimationDone.bind(Object(o.a)(i)),i.reset=i.reset.bind(Object(o.a)(i));var a=new I(t.rows,t.columns).spawnCells(1,2,!0);return i.state={board:a},i.acceptInput=!0,i.expectedAnimations=-1,i}return Object(c.a)(n,[{key:"reset",value:function(){var t=new I(this.props.rows,this.props.columns).spawnCells(1,2,!0);this.acceptInput=!0,this.expectedAnimations=-1,this.setState({board:t})}},{key:"generateBackgroundCells",value:function(t,e){for(var n=[],i=0;i<t;i++)for(var a=0;a<e;a++)n.push(Object(v.jsx)(b,{row:i,col:a},i*e+a));return n}},{key:"handleAnimationDone",value:function(){if(this.expectedAnimations-=1,0===this.expectedAnimations){var t=this.state.board.applyMoves().spawnCells(1,2,!0);this.acceptInput=!0;t.checkGameStatus();this.setState({board:t})}}},{key:"handleKeyDown",value:function(t){if(this.acceptInput){var e,n,i=this.state.board;switch(t.keyCode){case 40:n=k;break;case 39:n=y;break;case 38:n=g;break;case 37:n=O;break;default:return}(e=i.move(n,!1))!==i&&(this.acceptInput=!1,this.expectedAnimations=e.cells.flat().reduce((function(t,e){return t+(e.isMoving()?1:0)}),0),this.setState({board:e}))}}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.props.registerResetCallback(this.reset)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var t=this,e=this.generateBackgroundCells(this.props.rows,this.props.columns),n=this.state.board.getNonEmptyCells().map((function(e){return Object(v.jsx)(f,{cell:e,animationDoneCallback:t.handleAnimationDone},e.cellIdentifier)}));return Object(v.jsxs)("div",{className:"gamegrid",style:{"--grid-rows":this.props.rows,"--grid-cols":this.props.columns},children:[e,n]})}}]),n}(a.a.Component),G=function(t){Object(u.a)(n,t);var e=Object(h.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("div",{className:"header-line-1",children:Object(v.jsx)("h1",{children:" 2048 "})}),Object(v.jsxs)("div",{className:"header-line-2",children:[Object(v.jsx)(N,{options:this.props.options,onGridSizeChanged:this.props.onGridSizeChanged}),Object(v.jsx)(R,{onNewGameClicked:this.props.onNewGameClicked})]})]})}}]),n}(a.a.Component),N=function(t){Object(u.a)(n,t);var e=Object(h.a)(n);function n(t){var i;return Object(l.a)(this,n),(i=e.call(this,t)).onChange=i.onChange.bind(Object(o.a)(i)),i}return Object(c.a)(n,[{key:"getOptions",value:function(){var t=[];return this.props.options.forEach((function(e){var n="".concat(e," x ").concat(e);t.push(Object(v.jsx)("option",{value:e,children:n},e))})),t}},{key:"onChange",value:function(t){t.target.blur(),this.props.onGridSizeChanged(parseInt(t.target.value))}},{key:"render",value:function(){return Object(v.jsxs)("form",{action:"#",children:[Object(v.jsx)("label",{htmlFor:"sizeselector",children:"Grid size: "}),Object(v.jsx)("select",{id:"sizeselector",onChange:this.onChange,children:this.getOptions()})]})}}]),n}(a.a.Component),R=function(t){Object(u.a)(n,t);var e=Object(h.a)(n);function n(){return Object(l.a)(this,n),e.apply(this,arguments)}return Object(c.a)(n,[{key:"render",value:function(){return Object(v.jsx)("button",{className:"new-game-btn",onClick:this.props.onNewGameClicked,children:"New Game"})}}]),n}(a.a.Component),S=function(t){Object(u.a)(n,t);var e=Object(h.a)(n);function n(t){var i;Object(l.a)(this,n),(i=e.call(this)).state={rows:n.DEFAULT_ROWS,columns:n.DEFAULT_COLS},i.gridOptions=[];for(var a=4;a<=8;a++)i.gridOptions.push(a);return i.handleGridResize=i.handleGridResize.bind(Object(o.a)(i)),i.handleNewGameClicked=i.handleNewGameClicked.bind(Object(o.a)(i)),i.setNewGameHandler=i.setNewGameHandler.bind(Object(o.a)(i)),i}return Object(c.a)(n,[{key:"handleGridResize",value:function(t){this.setState({rows:t,columns:t})}},{key:"setNewGameHandler",value:function(t){this.newGameHandler=t}},{key:"handleNewGameClicked",value:function(){this.newGameHandler&&this.newGameHandler()}},{key:"render",value:function(){return Object(v.jsxs)("div",{className:"gamecontainer",children:[Object(v.jsx)(G,{options:this.gridOptions,onGridSizeChanged:this.handleGridResize,onNewGameClicked:this.handleNewGameClicked}),Object(v.jsx)(x,{rows:this.state.rows,columns:this.state.columns,registerResetCallback:this.setNewGameHandler},this.state.rows*this.state.columns)]})}}]),n}(a.a.Component);S.DEFAULT_ROWS=4,S.DEFAULT_COLS=4;n(14);r.a.render(Object(v.jsx)(S,{}),document.getElementById("root"))}},[[15,1,2]]]);
//# sourceMappingURL=main.829014a8.chunk.js.map