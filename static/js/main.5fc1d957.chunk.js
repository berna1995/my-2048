(this["webpackJsonpmy-2048"]=this["webpackJsonpmy-2048"]||[]).push([[0],{138:function(t,e,i){},139:function(t,e,i){"use strict";i.r(e);var n=i(0),a=i.n(n),s=i(47),r=i.n(s),o=i(18),l=i(11),c=i(12),u=i(25),h=i(24),d=function(){function t(e){Object(l.a)(this,t),this.startTime=null,this.duration=e,this.animationDone=!1}return Object(c.a)(t,[{key:"getTimeRatio",value:function(t){if(null===this.startTime)return this.startTime=t,0;var e=t-this.startTime,i=Math.min(1,e/this.duration);return i>=1&&(this.animationDone=!0),i}},{key:"isDone",value:function(){return this.animationDone}},{key:"reset",value:function(t){this.startTime=t,this.animationDone=!1}}]),t}(),p=function(){function t(e,i,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];Object(l.a)(this,t),this.fromValue=e,this.toValue=i,this.valDiff=i-e,this.currentVal=e,this.reverse=a,this.animationHelper=new d(n)}return Object(c.a)(t,[{key:"setUpdatedValueCallback",value:function(t){return this.updateCallback=t,this}},{key:"update",value:function(t){var e=this.animationHelper.getTimeRatio(t);if(this.currentVal=this.fromValue+this.valDiff*e,this.updateCallback&&this.updateCallback(this.currentVal),this.animationHelper.isDone()&&this.reverse){this.reverse=!1,this.animationHelper.reset(t);var i=this.fromValue;this.fromValue=this.toValue,this.toValue=i,this.valDiff=this.toValue-this.fromValue,this.currentVal=this.fromValue}}},{key:"getCurrentValue",value:function(){return this.currentVal}},{key:"isCompleted",value:function(){return this.animationHelper.isDone()}}]),t}(),m=function(){function t(){Object(l.a)(this,t),this.animationList=[],this.currentAnimationIndex=0}return Object(c.a)(t,[{key:"update",value:function(t){if(this.currentAnimationIndex<this.animationList.length){var e=this.animationList[this.currentAnimationIndex];e.update(t),e.isCompleted()&&this.currentAnimationIndex++}}},{key:"addAnimator",value:function(t){this.animationList.push(t)}},{key:"isCompleted",value:function(){return this.animationList.every((function(t){return t.isCompleted()}))}}]),t}(),v=i(5),f=function(t){Object(u.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(l.a)(this,i),(n=e.call(this,t)).divRef=a.a.createRef(),n.animate=n.animate.bind(Object(o.a)(n)),n.resetAnimationStatus(),n.state={translationX:0,translationY:0,scaleFactor:100},n.recycled=!1,n}return Object(c.a)(i,[{key:"render",value:function(){var t={gridRow:this.props.cell.row+1,gridColumn:this.props.cell.col+1};this.props.cell.isMoving()&&(t.transform="translate(".concat(this.state.translationX,"px, ").concat(this.state.translationY,"px) scale(").concat(this.state.scaleFactor,"%)"));var e=[];e.push("value-cell"),e.push("value-".concat(Math.min(2048,this.props.cell.val))),e.push(this.props.cell.isGettingMerged()?"value-cell-merged":"value-cell-top"),this.recycled||(e.push("value-cell-pop-in"),this.recycled=!0);var i=e.join(" ");return Object(v.jsx)("div",{className:i,style:t,ref:this.divRef,children:this.props.cell.val})}},{key:"componentDidUpdate",value:function(t){t.cell.isMoving()&&!this.props.cell.isMoving()&&this.resetAnimationStatus(),this.props.cell.isMoving()&&!this.animationDone&&0===this.animationRequestId&&(this.animation=this.prepareAnimation(),this.animationRequestId=window.requestAnimationFrame(this.animate))}},{key:"componentWillUnmount",value:function(){0!==this.animationRequestId&&window.cancelAnimationFrame(this.animationRequestId)}},{key:"animate",value:function(t){this.animation.update(t),this.animation.isCompleted()?(this.animation=null,this.animationDone=!0,this.animationRequestId=0,this.props.animationDoneCallback()):this.animationRequestId=window.requestAnimationFrame(this.animate)}},{key:"prepareAnimation",value:function(){var t=this,e=new m,n=this.props.cell.colDestination-this.props.cell.col,a=this.props.cell.rowDestination-this.props.cell.row,s=Number.parseInt(getComputedStyle(this.divRef.current).getPropertyValue("--grid-border").trim().replace("px","")),r=this.divRef.current.getBoundingClientRect(),o=r.width,l=r.height,c=0!==n,u=c?n*o+s*n:a*l+s*a,h=c?n:a,d=Math.abs(h)*i.TRANSLATION_1_CELL_DURATION,v=new p(0,u,d).setUpdatedValueCallback((function(e){var i=0!==n?e:0,s=0!==a?e:0;t.setState({translationX:i,translationY:s})}));if(e.addAnimator(v),this.props.cell.isMergingInto()){var f=new p(100,115,i.SCALING_DURATION,!0).setUpdatedValueCallback((function(e){t.setState({scaleFactor:e})}));e.addAnimator(f)}return e}},{key:"resetAnimationStatus",value:function(){this.animation=null,this.animationDone=!1,this.animationRequestId=0}}]),i}(a.a.Component);f.TRANSLATION_1_CELL_DURATION=50,f.SCALING_DURATION=100;var g=function(t){Object(u.a)(i,t);var e=Object(h.a)(i);function i(){return Object(l.a)(this,i),e.apply(this,arguments)}return Object(c.a)(i,[{key:"render",value:function(){return Object(v.jsx)("div",{className:"bg-cell",style:{gridRow:this.props.row+1,gridColumn:this.props.col+1}})}}]),i}(a.a.Component);function b(t){return Math.floor(Math.random()*t)}var y=0,j=1,k=2,O=3,w=0,S=1,C=2,x=function(){function t(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],c=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:null;Object(l.a)(this,t),this.row=e,this.col=i,this.val=n,this.nextVal=a,this.rowDestination=s,this.colDestination=r,this.mergedInto=o,this.mergingInto=c,this.cellIdentifier=u||t.nextIdentifierAvailable++}return Object(c.a)(t,[{key:"isEmpty",value:function(){return 0===this.val}},{key:"applyMoveAndClear",value:function(){this.isMoving()&&(this.row=this.rowDestination,this.col=this.colDestination,0!==this.nextVal&&(this.val=this.nextVal,this.nextVal=0),this.rowDestination=null,this.colDestination=null,this.mergingInto=!1,this.mergedInto=!1)}},{key:"moveBy",value:function(t,e){switch(null===this.rowDestination&&(this.rowDestination=this.row),null===this.colDestination&&(this.colDestination=this.col),e){case y:this.rowDestination=this.rowDestination-t;break;case k:this.rowDestination=this.rowDestination+t;break;case O:this.colDestination=this.colDestination-t;break;case j:this.colDestination=this.colDestination+t;break;default:return}}},{key:"isMoving",value:function(){return null!==this.rowDestination||null!==this.colDestination}},{key:"markGettingMerged",value:function(){this.mergedInto=!0}},{key:"markMerging",value:function(){this.mergingInto=!0}},{key:"isGettingMerged",value:function(){return this.mergedInto}},{key:"isMergingInto",value:function(){return this.mergingInto}},{key:"copy",value:function(){return new t(this.row,this.col,this.val,this.nextVal,this.rowDestination,this.colDestination,this.mergedInto,this.mergingInto,this.cellIdentifier)}}]),t}();x.nextIdentifierAvailable=1;var D=function(){function t(e,i,n){Object(l.a)(this,t),this.ROWS=e,this.COLUMNS=i,n?this.cells=n:(this.cells=Array(e).fill().map((function(){return Array(i).fill()})),t.initializeGrid(this.cells,e,i))}return Object(c.a)(t,[{key:"copy",value:function(){var e=this.cells.map((function(t){return t.map((function(t){return t.copy()}))}));return new t(this.ROWS,this.COLUMNS,e)}},{key:"getNonEmptyCells",value:function(){var t=[];return this.cells.forEach((function(e){e.forEach((function(e){e.isEmpty()||t.push(e)}))})),t}},{key:"applyMoves",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],i=e?this:this.copy(),n=i.cells.flat();return t.initializeGrid(i.cells,i.ROWS,i.COLUMNS),n.forEach((function(t){t.isMoving()?t.isGettingMerged()||(i.cells[t.rowDestination][t.colDestination]=t,t.applyMoveAndClear()):t.isEmpty()||t.isGettingMerged()||(i.cells[t.row][t.col]=t)})),i}},{key:"spawnCells",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=i?this:this.copy(),a=[];if(n.cells.forEach((function(t){t.forEach((function(t){t.isEmpty()&&a.push(t)}))})),a.length<t)return this;for(var s=0;s<t;s++){var r=b(a.length),o=a[r];n.cells[o.row][o.col].val=e,a.splice(r,1)}return n}},{key:"move",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=e?this:this.copy(),n=[];switch(t){case y:for(var a=0;a<i.COLUMNS;a++){for(var s=[],r=0;r<i.ROWS;r++)s.push(i.cells[r][a]);n.push(s)}break;case k:for(var o=0;o<i.COLUMNS;o++){for(var l=[],c=i.ROWS-1;c>=0;c--)l.push(i.cells[c][o]);n.push(l)}break;case O:n=i.cells.map((function(t){return t.slice()}));break;case j:n=i.cells.map((function(t){return t.slice().reverse()}));break;default:return}n.forEach((function(e){for(var i=null,n=0;n<e.length;n++){var a=e[n];if(a.isEmpty())for(var s=n+1;s<e.length;s++)e[s].isEmpty()||e[s].moveBy(1,t);else if(null===i)i=a;else if(i.val===a.val){i.markGettingMerged(),a.nextVal=2*a.val,a.markMerging();for(var r=n;r<e.length;r++)e[r].isEmpty()||e[r].moveBy(1,t);i=null}else i=a}}));var u=i.cells.flat().reduce((function(t,e){return t+(e.isMoving()?1:0)}),0);return u?i:this}},{key:"checkGameStatus",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2048,i=this.cells.flat(),n=i.some((function(t){return t.val>=e}));if(n)return w;var a=[y,k,O,j],s=a.some((function(e){return t.move(e)!==t}));return s?C:S}},{key:"getCurrentScore",value:function(){return this.cells.flat().reduce((function(t,e){return t+e.val}),0)}},{key:"toString",value:function(){return this.cells.map((function(t){return t.map((function(t){return t.val})).join(" ")})).join("\r\n")}}],[{key:"initializeGrid",value:function(t,e,i){for(var n=0;n<e;n++)for(var a=0;a<i;a++)t[n][a]=new x(n,a);return t}}]),t}(),N=function(t){Object(u.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(l.a)(this,i),(n=e.call(this,t)).handleKeyDown=n.handleKeyDown.bind(Object(o.a)(n)),n.handleAnimationDone=n.handleAnimationDone.bind(Object(o.a)(n)),n.reset=n.reset.bind(Object(o.a)(n)),n.state=n.reset(!0),n}return Object(c.a)(i,[{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=new D(this.props.rows,this.props.columns).spawnCells(2,2,!0);this.acceptInput=!0,this.expectedAnimations=-1,this.autoMode=!1,this.autoModeToken="boom",this.autoModeIndex=0;var i={board:e,gameStatus:C};return t||this.setState(i),i}},{key:"generateBackgroundCells",value:function(t,e){for(var i=[],n=0;n<t;n++)for(var a=0;a<e;a++)i.push(Object(v.jsx)(g,{row:n,col:a},n*e+a));return i}},{key:"handleAnimationDone",value:function(){if(this.expectedAnimations-=1,0===this.expectedAnimations){var t=this.state.board.applyMoves().spawnCells(1,Math.random()<.9?2:4,!0),e=t.checkGameStatus();e===C&&(this.acceptInput=!0),this.props.onNewScore(t.getCurrentScore()),this.autoMode&&e===C?this.setState({board:t,gameStatus:e},this.autoPlay):this.setState({board:t,gameStatus:e})}}},{key:"handleKeyDown",value:function(t){if(this.autoMode&&(this.autoMode=!1),this.acceptInput){var e,i,n=this.state.board;if(t.key===this.autoModeToken[this.autoModeIndex]){if(this.autoModeIndex++,this.autoModeIndex>=this.autoModeToken.length)return this.autoMode=!0,void this.autoPlay()}else this.autoModeIndex=0;switch(t.keyCode){case 40:i=k;break;case 39:i=j;break;case 38:i=y;break;case 37:i=O;break;default:return}(e=n.move(i,!1))!==n&&(this.acceptInput=!1,this.expectedAnimations=e.cells.flat().reduce((function(t,e){return t+(e.isMoving()?1:0)}),0),this.setState({board:e}))}}},{key:"autoPlay",value:function(){var t=this;setTimeout((function(){if(t.autoMode){for(var e,i=[y,k,O,j],n=t.state.board;!e;){var a=b(i.length),s=i[a],r=n.move(s);r!==n?e=r:i.splice(a,1)}t.acceptInput=!1,t.expectedAnimations=e.cells.flat().reduce((function(t,e){return t+(e.isMoving()?1:0)}),0),t.setState({board:e})}}),300)}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.props.registerResetCallback(this.reset)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var t=this,e=this.generateBackgroundCells(this.props.rows,this.props.columns),i=this.state.board.getNonEmptyCells().map((function(e){return Object(v.jsx)(f,{cell:e,animationDoneCallback:t.handleAnimationDone},e.cellIdentifier)})),n=[];return this.state.gameStatus===w?n.push(Object(v.jsx)("div",{className:"grid-overlay",children:"Gratz, you've won!"})):this.state.gameStatus===S&&n.push(Object(v.jsx)("div",{className:"grid-overlay",children:"You lost, will go better next time!"})),Object(v.jsxs)("div",{className:"gamegrid",style:{"--grid-rows":this.props.rows,"--grid-cols":this.props.columns},children:[e,i,n]})}}]),i}(a.a.Component),I=i(151),M=i(149),G=i(150),A=function(){function t(){Object(l.a)(this,t),void 0===localStorage?(this.fallbackStorage={},this.supportsLocalStorage=!1):this.supportsLocalStorage=!0}return Object(c.a)(t,[{key:"getHighestScore",value:function(t){var e="grid-"+t.toString();if(this.supportsLocalStorage){var i=localStorage.getItem(e);return i?Number.parseInt(i):0}var n=this.fallbackStorage[e];return void 0===n?0:n}},{key:"setHighestScore",value:function(t,e){var i="grid-"+t.toString();this.supportsLocalStorage?localStorage.setItem(i,e.toString()):this.fallbackStorage[i]=e}}]),t}(),R=function(t){Object(u.a)(i,t);var e=Object(h.a)(i);function i(){return Object(l.a)(this,i),e.apply(this,arguments)}return Object(c.a)(i,[{key:"render",value:function(){return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsxs)("div",{className:"header-line-1",children:[Object(v.jsx)("div",{className:"game-title",children:"2048"}),Object(v.jsx)(T,{title:"Current",value:this.props.currentScore}),Object(v.jsx)(T,{title:"Top Score",value:this.props.topScore})]}),Object(v.jsxs)("div",{className:"header-line-2",children:[Object(v.jsx)("div",{className:"game-exp",children:"Use arrow keys to slide the tiles."}),Object(v.jsx)(L,{options:this.props.options,onGridSizeChanged:this.props.onGridSizeChanged,defaultGridSize:this.props.defaultGridSize}),Object(v.jsx)(V,{onNewGameClicked:this.props.onNewGameClicked})]})]})}}]),i}(a.a.Component),L=function(t){Object(u.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(l.a)(this,i),(n=e.call(this,t)).onChange=n.onChange.bind(Object(o.a)(n)),n.myRef=a.a.createRef(),n}return Object(c.a)(i,[{key:"onChange",value:function(t,e){this.myRef.current.blur(),this.props.onGridSizeChanged(parseInt(e.value))}},{key:"render",value:function(){return Object(v.jsx)(I.a,{innerRef:this.myRef,children:Object(v.jsx)(M.a,{style:{margin:0},text:"Grid Size",icon:"grid layout",labeled:!0,floating:!0,button:!0,className:"icon",options:this.props.options,defaultValue:this.props.defaultGridSize,onChange:this.onChange,closeOnBlur:!0})})}}]),i}(a.a.Component),V=function(t){Object(u.a)(i,t);var e=Object(h.a)(i);function i(t){var n;return Object(l.a)(this,i),(n=e.call(this,t)).onClick=n.onClick.bind(Object(o.a)(n)),n}return Object(c.a)(i,[{key:"onClick",value:function(t){t.target.blur(),this.props.onNewGameClicked()}},{key:"render",value:function(){return Object(v.jsx)(G.a,{style:{margin:0},color:"teal",onClick:this.onClick,children:"New Game"})}}]),i}(a.a.Component),T=function(t){Object(u.a)(i,t);var e=Object(h.a)(i);function i(){return Object(l.a)(this,i),e.apply(this,arguments)}return Object(c.a)(i,[{key:"render",value:function(){return Object(v.jsxs)("div",{className:"score-container",children:[Object(v.jsx)("div",{className:"score-title",children:this.props.title}),Object(v.jsx)("div",{className:"score-value",children:Object(v.jsx)("p",{children:this.props.value},this.props.value)})]})}}]),i}(a.a.Component),E=function(t){Object(u.a)(i,t);var e=Object(h.a)(i);function i(t){var n;Object(l.a)(this,i),(n=e.call(this)).state={rows:i.DEFAULT_ROWS,columns:i.DEFAULT_COLS,currentScore:0},n.gridOptions=[];for(var a=4;a<=8;a++)n.gridOptions.push({key:a,text:a.toString()+" x "+a.toString(),value:a});return n.handleGridResize=n.handleGridResize.bind(Object(o.a)(n)),n.handleNewGameClicked=n.handleNewGameClicked.bind(Object(o.a)(n)),n.setNewGameHandler=n.setNewGameHandler.bind(Object(o.a)(n)),n.handleNewScore=n.handleNewScore.bind(Object(o.a)(n)),n.storage=new A,n}return Object(c.a)(i,[{key:"handleGridResize",value:function(t){this.setState({rows:t,columns:t,currentScore:0})}},{key:"setNewGameHandler",value:function(t){this.newGameHandler=t}},{key:"handleNewGameClicked",value:function(){this.newGameHandler&&this.newGameHandler(),this.setState({currentScore:0})}},{key:"handleNewScore",value:function(t){t>this.storage.getHighestScore(this.state.rows)&&this.storage.setHighestScore(this.state.rows,t),this.setState({currentScore:t})}},{key:"render",value:function(){return Object(v.jsxs)("div",{className:"gamecontainer",children:[Object(v.jsx)(R,{options:this.gridOptions,defaultGridSize:this.gridOptions[0].value,onGridSizeChanged:this.handleGridResize,onNewGameClicked:this.handleNewGameClicked,currentScore:this.state.currentScore,topScore:this.storage.getHighestScore(this.state.rows)}),Object(v.jsx)(N,{rows:this.state.rows,columns:this.state.columns,registerResetCallback:this.setNewGameHandler,onNewScore:this.handleNewScore},this.state.rows*this.state.columns),Object(v.jsxs)("div",{className:"footer",children:["Game developed by Matteo Bernabito.",Object(v.jsx)("br",{}),"Take a look at the source on my ",Object(v.jsx)("a",{href:"https://github.com/berna1995/my-2048",children:"Github"}),"."]})]})}}]),i}(a.a.Component);E.DEFAULT_ROWS=4,E.DEFAULT_COLS=4;i(137),i(138);r.a.render(Object(v.jsx)(E,{}),document.getElementById("root"))}},[[139,1,2]]]);
//# sourceMappingURL=main.5fc1d957.chunk.js.map